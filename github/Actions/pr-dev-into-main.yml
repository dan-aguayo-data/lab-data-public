name: Action - PR Dev into Main

on:
  workflow_dispatch:

jobs:
  validate_branch:
    runs-on: ubuntu-latest
    steps:
      - name: Ensure main branch context
        if: github.ref != 'refs/heads/main'
        run: |
          echo "This workflow must be run from the main branch context"
          exit 1

  create_pr:
    needs: validate_branch
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Create PR from dev to main
        id: create_pr
        run: |
          echo "Creating pull request..."
          pr_url=$(gh pr create \
            --base main \
            --head dev \
            --title "Merge dev into main for production deployment" \
            --body "This PR was generated by GitHub Actions." \
            --label autopr )
          echo "Pull request created: $pr_url"
          echo "url=$pr_url" >> $GITHUB_OUTPUT
        env:
          GH_TOKEN: ${{ secrets.CUSTOM_GITHUB_PAT_TOKEN }}



      - name: Display PR URL
        run: |
          echo "Pull Request: ${{ steps.create_pr.outputs.url }}"


